<!DOCTYPE html>
<html lan="en">

    <head>
        <title>Turn on the lights</title>
        <script type="text/javascript" src="lib/webgl-utils.js"></script>
        <script type="text/javascript" src="lib/MV.js"></script>
        <script type="text/javascript" src="lib/InitShaders.js"></script>
        
        <link rel="stylesheet" type="text/css" href="assets/style/main-style.css" />

        <script type="text/javascript" src="image_tool.js"></script>
        
        
        <script id="inten-diff-vertex-shader" type="x-shader/x-vertex">
            attribute vec2 a_Position;
            attribute vec2 a_TexCoord; // texture coordinate of the vertex
            uniform vec2 u_Resolution;
            
            //varying vec3 v_Position;
            varying vec2 v_TexCoord; // pass texture coordinates to the fragment shader

        
            
            void main(){

                //convert position data from pixels to range 0.0 - 1.0 (normalize)
                vec2 normalized_pos = a_Position / u_Resolution;
                // convert 0.0 - 1.0 to 0.0 - 2.0;
                vec2 doubled_pos = normalized_pos * 2.0;
                // convert to clip coords -1.0 - 1.0
                vec2 clipCoords = doubled_pos - 1.0;

                gl_Position = vec4(clipCoords, 0.0, 1.0);

                //v_Position = a_Position;
                v_TexCoord = a_TexCoord;
            }
        </script>
        
        <script id="inten-diff-fragment-shader" type="x-shader/x-fragment">
            precision highp float;
            
            //varying vec3 v_Position;
            varying vec2 v_TexCoord;
             
            uniform sampler2D u_Image1;
            uniform sampler2D u_Image2;

            uniform int u_ImFlag1;
            uniform int u_ImFlag2;

            uniform float u_Dx;
            uniform float u_Dy;

            uniform float u_S; //adjusts level of detail that shows up

            vec2 uv_1;
            vec2 uv_2;

            vec4 im1Color = vec4(0.0,0.0,0.0,0.0);
            vec4 im2Color = vec4(0.0,0.0,0.0,0.0);

            void main(){
                
                //gl_FragColor = texture2D(u_Image1, v_TexCoord);

                if(u_ImFlag1 == 1){
                    im1Color = texture2D(u_Image1, v_TexCoord);
                    if(u_ImFlag2 == 0){
                        gl_FragColor = im1Color;
                    }
                }

                if(u_ImFlag2 == 1){
                    uv_2 = v_TexCoord - vec2(u_Dx, u_Dy);
                    if(uv_2.x >= 0.0 && uv_2.x <= 1.0 && uv_2.y >= 0.0 && uv_2.y <= 1.0){
                        im2Color = texture2D(u_Image2, uv_2);
                    }else{
                        im2Color = vec4(1.0,1.0,1.0,1.0);
                    }
                    
                    if(u_ImFlag1 == 0){
                        gl_FragColor = im2Color;
                    }
                }

                if(u_ImFlag1 == 1 && u_ImFlag2 == 1){
                    gl_FragColor = vec4((((im2Color).rgb - (im1Color).rgb )* u_S) + 0.5, 1.0);
                }

                if(u_ImFlag1 == 0 && u_ImFlag2 == 0){
                    gl_FragColor = vec4(0.0,0.0,0.0,1.0);
                }
                
            }
        </script>

    </head>
    <body>
        <div>
            <p id="dxdy_text">
                offset &gt&gt dx: <span id="dx_text"></span> dy: <span id ="dy_text"></span>
            </p>
        </div>
        <canvas id="gl-canvas" width="400" height="300">
            You need a better web browser
        </canvas>
        <p>
            <input id="im1_box" type="checkbox" name="" value="point" /> Image 1
            <input id="im2_box" type="checkbox" name="point" value="point" /> Image 2
        </p>

       <p>
            <select id="effect_menu">
                <option value="e1">Intensity Difference</option>
                <option value="e2">Convolution</option>
            </select>
        </p>

        <pre>
        <center>
<strong>WASD</strong> or <strong>click & drag</strong> to shift image                                     <strong>shift:</strong> lock image motion to x direction only
<strong>q:</strong> slow down image motion                                               <strong>e:</strong> speed up image motion
       </center> 
        </pre>
    
    </body>
</html>